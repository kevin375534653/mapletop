<html lang="en">
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<head>
		<BASE HREF="" />

		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="{WebDescripcion}">
		<meta name="keywords" content="{keywords}">
		<meta name="robots" content="index,follow,noodp,noydir">
		<title>Maple社区 | 邀请码</title>
		<meta property="og:title" content="Kaotic">
		<meta property="og:type" content="article">
		<meta property="og:url" content="https://mastermaple.com/">
		<meta property="og:image" content="https://mastermaple.com/img/slider2.png">
		<meta property="og:site_name" content="Kaotic">
		<meta property="og:description" content="Enjoy the old maplestory with several custom functions that changes the way you play kaotically">
		<link rel="icon" href="../img/favicon.ico">
		<link rel="stylesheet" type="text/css" href="../css/banner-styles2d4a.css?v=omkqRugM" />
		<link rel="stylesheet" type="text/css" href="../css/iconochive8307.css?v=qtvMKcIJ" />
		<link href="../css/gnb_cdn_http_white.css" rel="stylesheet" type="text/css">
		<link href="../css/common.css" rel="stylesheet" />
		<link href="../css/Notice.css" rel="stylesheet" />
		<link href="../layui/css/layui.css" rel="stylesheet">
		<script src="../layui/layui.js"></script>
		<script src="../js/jquery-2.1.4.min.js"></script>
		<script src="../js/jquery.easing.1.3.js"></script>
		<script src="../js/jquery.colorbox-1.4.27.min.js"></script>
		<script src="../js/swiper.min.js"></script>
		<script src="../js/jquery.placeholder.min.js"></script>
		<script src="../js/jquery.cookie.js"></script>
		<script src="../js/Common.js"></script>
		<script src="../js/npf_auth_c.js" type="text/javascript"></script>
		<script src="../js/NGMModuleInfo.js" type="text/javascript"></script>
		<script src="../js/npf_ngm.js" type="text/javascript"></script>

	</head>
	<body class="night">
		<style type="text/css">
			body {
				margin-top: 0 !important;
				padding-top: 0 !important;
			}

			.sub .side-menu {
				top: 110px;
			}

			.list .entry01 h3 {
				background: url(../img/loading/xgmm_loading.png) no-repeat 0 0;
				height: 50px;
				margin: 10px auto 30px;
			}

			.half {
				width: 50%;
				text-align: initial;
				float: left;
			}

			button {
				height: 25px !important;
				font-size: 12px !important;
				margin-top: 20px !important;
			}

			input,
			select {
				height: 30px !important;
				font-size: 12px !important;
				margin-top: 2px !important;
			}

			span {
				font-size: 12px;
			}

			.sub aside .btn-login {
				left: 35px !important;
			}

			.sub aside .btn-regist {
				left: 35px !important;
			}

			input[type=text],
			input[type=password] {
				border: solid 1px #eee;
			}
		</style>
		<div class="wrapper">
			<header>
				<h1><a href="../">Maple社区</a></h1>
				<nav>
					<ul>
						<li class="menu01">
							<a href="../index.html">Inicio</a>
						</li>
						<li class="menu02">
							<a href="../download.html">Downloads</a>
						</li>
						<li class="menu03">
							<a href="../ranking.html">Ranking</a>
						</li>
						<li class="menu04">
							<a href="../web/topsites.html"></a>
						</li>
						<li class="menu05">
							<a href="javascript:;" onclick="layui.layer.msg('功能正在开发')">More</a>
						</li>
					</ul>
				</nav>
			</header>

			<div class="container">
				<article class="list">
					<div class="section entry01" id="anc01">
						<div class="inner" id="noticeList">
							<div class="search-box">
								<p class="btn-search"><a href="javascript:void(0);" onclick="history.back()">return</a>
								</p>
								<input type="text" style="display:none;" value="1" name="setpage" id="setpage">
							</div>
							<h3>Noticia</h3>
							<div class="notice-area" id="notice-area">
								<div style="height:auto;">
									<span>修改密码</span><br>
									<ul class="latest">
										<li>
											<div class="layui-form-item">
												<label class="layui-form-label">账号</label>
												<div class="layui-input-inline">
													<input type="input" id="name" required lay-verify="required" placeholder="请输入账号" autocomplete="off" class="layui-input">
												</div>
											</div>
											<div class="layui-form-item">
												<label class="layui-form-label">新密码</label>
												<div class="layui-input-inline">
													<input type="input" id="password" required lay-verify="required" placeholder="请输新入密码" autocomplete="off" class="layui-input">
												</div>
											</div>
											<div class="layui-form-item">
												<label class="layui-form-label">验证方式</label>
												<div class="layui-input-inline">
													<select name="verify_source" id="verify_source" lay-verify="verify_source" class="layui-input">
														<option value="">请选择验证方式</option>
														<option value="EMAIL">QQ邮箱</option>
														<!--                <option value="SMS">手机</option>-->
													</select>
												</div>
											</div>
											<div id="email_hidden_div" style="display:none;">
												<div class="layui-form-item">
													<div class="layui-inline">
														<label class="layui-form-label">邮箱</label>
														<div class="layui-input-inline">
															<input type="input" id="email" required lay-verify="required" placeholder="请输入邮箱" autocomplete="off" class="layui-input">
														</div>
													</div>
													<div class="layui-inline">
														<div class="layui-input-inline">
															<a href="javascript:;" class="layui-btn layui-btn-sm layui-btn-primary" onclick="getEmailCode()">获取邮箱验证码</a>
														</div>
													</div>
												</div>
												<div class="layui-form-item">
													<label class="layui-form-label">邮箱验证码</label>
													<div class="layui-input-inline">
														<input type="input" id="email_code" required lay-verify="required" placeholder="请输入邮箱验证码" autocomplete="off" class="layui-input">
													</div>
												</div>
											</div>
											<div id='mobile_hidden_div' style="display:none;">
												<div class="layui-form-item">
													<div class="layui-inline">
														<label class="layui-form-label">手机号</label>
														<div class="layui-input-inline">
															<input type="input" id="mobile" required lay-verify="required" placeholder="请输入手机号" autocomplete="off" class="layui-input">
														</div>
													</div>
													<div class="layui-inline">
														<div class="layui-input-inline">
															<a href="javascript:;" class="layui-btn layui-btn-sm layui-btn-primary" onclick="getMobileCode()">获取手机验证码</a>
														</div>
													</div>
												</div>
												<div class="layui-form-item">
													<label class="layui-form-label">手机验证码</label>
													<div class="layui-input-inline">
														<input type="input" id="mobile_code" required lay-verify="required" placeholder="请输入手机验证码" autocomplete="off" class="layui-input">
													</div>
												</div>
											</div>
											<div class="layui-form-item">
												<div class="layui-form-label layui-input-inline">
													<a href="javascript:;" class="layui-btn layui-btn-sm layui-btn-primary" onclick="click_reset_password()">确定</a>
												</div>
											</div>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</article>
				<!-- 登陆 -->
				<div class="sub">
					<!-- 登陆注册 -->
					<aside id="login_box">
						<form id="FormRegistro">
							<p class="btn-login" style="margin-top: 86px;">
								<input type="text" name="login_username" id="login_username" placeholder="用户名"><br>
								<input type="password" name="login_password" id="login_password" placeholder="密码">
							</p>
						</form>
						<p class="btn-regist" style="bottom: 43px !important;display: block;">
							<a href="javascript:void(0)" class="btnlogin"></a>
						</p>
					</aside>
					<!-- 用户功能 -->
					<aside id="login_success">
						<p class="btn-login">
							<span>用户名：<label class="user_name"></label></span><br />
							<span>账号状态：
								<span id="user_ban"></span>
								<span id="todayVote"></span>
							</span><br>
							抵用券：<span id="mpoints" class="layui-badge layui-bg-green"></span>
							点券：<span id="nxcredit" class="layui-badge layui-bg-green"></span>
						</p>
						<p class="btn-ability">
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./reset_status.html">卡号自救</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./invitation.html">邀请系统</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./reset_password.html">修改密码</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./exchange_use.html">充值卡密</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./bindMac.html">绑机器码</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./bindMobile.html">绑定手机</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./resetMobile.html">更换手机</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./invitation_code_add.html">邀请码</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./bindSecondPass.html">二次密保</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal logout" href="javascript:;">退出登陆</a>
						</p>
					</aside>
				</div>
			</div>

			<footer>
			</footer>

		</div>

		<script type="text/javascript">
			layui.use(['form'], function() {
				var layer = layui.layer,
					form = layui.form
				App = {
					data: {
						userName: "",
						password: "",
					},
					init() {
						var __this = this,
							load = sessionStorage.getItem("data")
						if (load != null) {
							__this.data = JSON.parse(load),
								__this.loadUserInfo()
						}

						$('.btnlogin').click(function() {
							__this.data.userName = $('#login_username').val(),
								__this.data.password = $('#login_password').val()
							$.ajax({
								contentType: 'application/json',
								type: 'POST',
								url: "/loginServer/auth/login",
								dataType: "json",
								data: JSON.stringify({
									name: __this.data.userName,
									password: __this.data.password
								}),
								success: function(message) {
									if (message.statusCode == 0) {
										$.cookie('token', message.data);
										__this.loadUserInfo()
									} else {
										layer.alert(message.message);
									}
								},
								error: function(res) {
									layer.msg(res.message)
								}
							})
						});
						$('.logout').click(function() {
							sessionStorage.removeItem("data"),
								$.cookie('token', null),
								__this.display('login_box'),
								__this.display('login_success')
						})
					},
					loadUserInfo: function() {
						var __this = this
						if (__this.data.userName != null && __this.data.password != null) {
							$.get(`/loginServer/api/webLogin`, {
								userName: __this.data.userName,
								password: __this.data.password
							}, function(res) {
								if (res.statusCode == 0) {
									res.data.userName = __this.data.userName,
										res.data.password = __this.data.password,
										__this.data = res.data
									if ($("#login_box").css("display") == "block") {
										__this.display('login_box')
									}
									if ($("#login_success").css("display") == "none") {
										__this.display('login_success')
									}
									$('.user_name').html(__this.data.name),
										$('#user_ban').html(__this.data.ban == 0 ? '正常' : '已封号'),
										__this.loadClass('#user_ban', __this.data.ban == 0 ? 'layui-badge layui-bg-cyan' : 'layui-badge layui-bg-orange'),
										$('#mpoints').html(__this.data.mpoints),
										$('#nxcredit').html(__this.data.nxcredit)
								}
							})
							$.get("/webServer/api/vote", {
								account: __this.data.userName
							}, function(res) {
								__this.data.todayVote = res
								console.log("todayVote=" + __this.data.todayVote)
								$('#todayVote').html(__this.data.todayVote == 0 ? '未投票' : '已投票'),
									__this.loadClass('#todayVote', __this.data.todayVote == 0 ? 'layui-badge layui-bg-orange' : 'layui-badge layui-bg-cyan')
							})
							sessionStorage.setItem("data", JSON.stringify(__this.data))
						}
						setTimeout(function() {
							__this.loadUserInfo()
						}, 60000)
					},
					loadClass: function(name, className) {
						$(`${name}`).removeClass()
						$(`${name}`).addClass(className);
					},
					display: function(name) {
						$(`#${name}`).is(":hidden") ? $(`#${name}`).show() : $(`#${name}`).hide()
					}
				}
				App.init()

				$(function() {
					var token = JSON.parse(sessionStorage.getItem("data"))
					$("#name").val(token.name)
					$('#verify_source').change(function() {
						let choose = $('#verify_source option:selected').val();
						if (choose == 'EMAIL') {
							$('#mobile_hidden_div').hide();
							$('#email_hidden_div').show();
						} else if (choose == 'SMS') {
							$('#email_hidden_div').hide();
							$('#mobile_hidden_div').show();
						}
					});
				});

				click_reset_password = function() {
					const choose = $('#verify_source option:selected').val();
					if (choose == undefined) {
						layer.alert("必须选中验证方式");
						return;
					}
					let data;
					if (choose == 'EMAIL') {
						const name = $.trim($("#name").val());
						const newPassword = $.trim($("#password").val());
						const email = $.trim($("#email").val());
						const code = $.trim($("#email_code").val());
						if (name.length == 0 || newPassword.length == 0 || email.length == 0 || code.length == 0) {
							layer.alert("参数不能为空");
							return;
						}
						data = {
							name: name,
							password: newPassword,
							email: email,
							code: code,
							verifyCodeSendType: 'EMAIL'
						};
						// layer.alert("当前不支持邮箱修改密码");

					} else if (choose == 'SMS') {

					}
					const url = "/loginServer/account/reset/password";
					$.ajax({
						contentType: 'application/json',
						type: 'POST',
						url: url,
						dataType: "json",
						data: JSON.stringify(data),
						success: function(message) {
							if (message.statusCode == 0) {
								layer.alert("修改密码成功");
							} else {
								layer.alert(message.message);
							}
						}
					});

				}

				getEmailCode = function() {
					const email = $.trim($("#email").val());
					if (email.length == 0) {
						layer.alert("无效的邮箱");
						return;
					}
					$.ajax({
						contentType: 'application/json',
						type: 'POST',
						url: "/loginServer/account/code",
						dataType: "json",
						data: JSON.stringify({
							email: email,
							codeType: "RESET_PASSWORD"
						}),
						success: function(message) {
							if (message.statusCode == 0) {
								layer.alert("获取成功,请注意您的邮箱来信");
							} else {
								layer.alert(message.message);
							}
						}
					});
				}

				getMobileCode = function() {
					const url = "/loginServer/account/code/phone";
					const phone = $.trim($("#mobile").val());
					if (phone.length == 0 || !checkPhone(phone)) {
						layer.alert("无效的手机号");
						return;
					}
					const data = {
						phone: phone,
						codeType: "RESET_PASSWORD"
					};
					$.ajax({
						contentType: 'application/json',
						type: 'POST',
						url: url,
						dataType: "json",
						data: JSON.stringify(data),
						success: function(message) {
							if (message.statusCode == 0) {
								layer.alert("获取成功,请注意您的手机短信");
							} else {
								layer.alert(message.message);
							}
						}
					});
				}
			})
		</script>
	</body>
</html>
