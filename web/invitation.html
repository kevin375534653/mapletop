<html lang="en">
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<head>
		<BASE HREF="" />

		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="{WebDescripcion}">
		<meta name="keywords" content="{keywords}">
		<meta name="robots" content="index,follow,noodp,noydir">
		<title>Maple社区 | 邀请系统</title>
		<meta property="og:title" content="Kaotic">
		<meta property="og:type" content="article">
		<meta property="og:url" content="https://mastermaple.com/">
		<meta property="og:image" content="https://mastermaple.com/img/slider2.png">
		<meta property="og:site_name" content="Kaotic">
		<meta property="og:description" content="Enjoy the old maplestory with several custom functions that changes the way you play kaotically">
		<link rel="icon" href="../img/favicon.ico">
		<link rel="stylesheet" type="text/css" href="../css/banner-styles2d4a.css?v=omkqRugM" />
		<link rel="stylesheet" type="text/css" href="../css/iconochive8307.css?v=qtvMKcIJ" />
		<link href="../css/gnb_cdn_http_white.css" rel="stylesheet" type="text/css">
		<link href="../css/common.css" rel="stylesheet" />
		<link href="../css/Notice.css" rel="stylesheet" />
		<link href="../layui/css/layui.css" rel="stylesheet">
		<script src="../layui/layui.js"></script>
		<script src="../js/jquery-2.1.4.min.js"></script>
		<script src="../js/jquery.easing.1.3.js"></script>
		<script src="../js/jquery.colorbox-1.4.27.min.js"></script>
		<script src="../js/jquery.cookie.js"></script>
		<script src="../js/auth.js"></script>
		<script src="../js/swiper.min.js"></script>
		<script src="../js/jquery.placeholder.min.js"></script>
		<script src="../js/Common.js"></script>
		<script src="../js/npf_auth_c.js" type="text/javascript"></script>
		<script src="../js/NGMModuleInfo.js" type="text/javascript"></script>
		<script src="../js/npf_ngm.js" type="text/javascript"></script>

	</head>
	<body class="night">
		<style type="text/css">
			body {
				margin-top: 0 !important;
				padding-top: 0 !important;
			}

			.sub .side-menu {
				top: 110px;
			}

			.list .entry01 h3 {
				background: url(../img/loading/yqxt_loading.png) no-repeat 0 0;
				height: 50px;
				margin: 10px auto 30px;
			}

			.half {
				width: 50%;
				text-align: initial;
				float: left;
			}

			form input,
			form select {
				height: 30px !important;
				font-size: 12px !important;
				margin-top: 2px !important;
			}

			span {
				font-size: 12px;
			}

			.sub aside .btn-login {
				left: 35px !important;
			}

			.sub aside .btn-regist {
				left: 35px !important;
			}

			input[type=text],
			input[type=password] {
				border: solid 1px #eee;
			}
		</style>
		<div class="wrapper">
			<header>
				<h1><a href="../">Maple社区</a></h1>
				<nav>
					<ul>
						<li class="menu01">
							<a href="../index.html">Inicio</a>
						</li>
						<li class="menu02">
							<a href="../download.html">Downloads</a>
						</li>
						<li class="menu03">
							<a href="../ranking.html">Ranking</a>
						</li>
						<li class="menu04">
							<a href="../web/topsites.html"></a>
						</li>
						<li class="menu05">
							<a href="javascript:;" onclick="layui.layer.msg('功能正在开发')">More</a>
						</li>
					</ul>
				</nav>
			</header>

			<div class="container">
				<article class="list">
					<div class="section entry01" id="anc01">
						<div class="inner" id="noticeList">
							<div class="search-box">
								<p class="btn-search"><a href="javascript:void(0);" onclick="history.back()">return</a>
								</p>
								<input type="text" style="display:none;" value="1" name="setpage" id="setpage">
							</div>
							<h3>Noticia</h3>
							<div class="notice-area" id="notice-area">
								<div style="height:auto;">
									<span>邀请系统</span><br>
									<ul class="latest">
										<li>
											<div class="layui-card">
												<div class="layui-row">
													<div class="layui-col-md3">
														<div class="layui-form-item">
															<label class="layui-form-label">上级邮箱</label>
															<div class="layui-input-inline">
																<input type="input" id="parentEmail" required lay-verify="required" autocomplete="off" class="layui-input" readonly="true">
															</div>
														</div>
													</div>
													<div class="layui-col-md3">
														<div class="layui-form-item">
															<label class="layui-form-label">上级邀请码</label>
															<div class="layui-input-inline">
																<input type="input" id="parentCode" required lay-verify="required" autocomplete="off" class="layui-input" readonly="true">
															</div>
														</div>
													</div>

													<div class="layui-col-md3">
														<div class="layui-form-item">
															<label class="layui-form-label">邀请码</label>
															<div class="layui-input-inline">
																<input type="input" id="code" required lay-verify="required" autocomplete="off" class="layui-input" readonly="true">
															</div>
														</div>
													</div>
													<div class="layui-col-md3">
														<div class="layui-form-item">
															<label class="layui-form-label">下级数量</label>
															<div class="layui-input-inline">
																<input type="input" id="invitationNumber" required lay-verify="required" autocomplete="off" class="layui-input" readonly="true">
															</div>
														</div>
													</div>

												</div>

											</div>
											<div class="layui-card">
												<div class="layui-card-header">下级账号信息</div>
												<div class="layui-card-body">
													<div class="layui-table" id="low_levels" lay-filter="low_levels">
														<script type="text/html" id="operations">
															<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">玩家角色列表</a>
														</script>

													</div>
												</div>
											</div>
											<div style="display:none" id="servers_div">
												<form class="layui-form" id="server_form">
													<div class="layui-form-item">
														<div class="layui-input-block" id="choose_server">
														</div>
													</div>
												</form>
											</div>
											<div style="display: none" id="characters_div">
												<div class="layui-card">
													<div class="layui-card-body">
														<div class="layui-table" id="characters" lay-filter="characters">
														</div>
													</div>
												</div>
											</div>

										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</article>
				<!-- 登陆 -->
				<div class="sub">
					<!-- 登陆注册 -->
					<aside id="login_box">
						<form id="FormRegistro">
							<p class="btn-login" style="margin-top: 86px;">
								<input type="text" name="login_username" id="login_username" placeholder="用户名"><br>
								<input type="password" name="login_password" id="login_password" placeholder="密码">
							</p>
						</form>
						<p class="btn-regist" style="bottom: 43px !important;display: block;">
							<a href="javascript:void(0)" class="btnlogin"></a>
						</p>
					</aside>
					<!-- 用户功能 -->
					<aside id="login_success">
						<p class="btn-login">
							<span>用户名：<label class="user_name"></label></span><br />
							<span>账号状态：
								<span id="user_ban"></span>
								<span id="todayVote"></span>
							</span><br>
							抵用券：<span id="mpoints" class="layui-badge layui-bg-green"></span>
							点券：<span id="nxcredit" class="layui-badge layui-bg-green"></span>
						</p>
						<p class="btn-ability">
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./reset_status.html">卡号自救</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./invitation.html">邀请系统</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./reset_password.html">修改密码</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./exchange_use.html">充值卡密</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./bindMac.html">绑机器码</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./bindMobile.html">绑定手机</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./resetMobile.html">更换手机</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./invitation_code_add.html">邀请码</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./bindSecondPass.html">二次密保</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal logout" href="javascript:;">退出登陆</a>
						</p>
					</aside>
				</div>
			</div>

			<footer>
			</footer>

		</div>

		<script>
			layui.use(['form', 'table'], function() {
				var form = layui.form,
					table = layui.table
				App = {
					data: {
						userName: "",
						password: "",
					},
					init() {
						var __this = this,
							load = sessionStorage.getItem("data")
						if (load != null) {
							__this.data = JSON.parse(load),
								__this.loadUserInfo()
						}
						$('.btnlogin').click(function() {
							__this.data.userName = $('#login_username').val(),
								__this.data.password = $('#login_password').val()
							$.ajax({
								contentType: 'application/json',
								type: 'POST',
								url: "/loginServer/auth/login",
								dataType: "json",
								data: JSON.stringify({
									name: __this.data.userName,
									password: __this.data.password
								}),
								success: function(message) {
									if (message.statusCode == 0) {
										$.cookie('token', message.data);
										__this.loadUserInfo()
									} else {
										layer.alert(message.message);
									}
								},
								error: function(res) {
									layer.msg(res.message)
								}
							})
						});

						$('.logout').click(function() {
							sessionStorage.removeItem("data"),
								$.cookie('token', null),
								__this.display('login_box'),
								__this.display('login_success')
						})
					},
					loadUserInfo: function() {
						var __this = this
						if (__this.data.userName != null && __this.data.password != null) {
							$.get(`/loginServer/api/webLogin`, {
								userName: __this.data.userName,
								password: __this.data.password
							}, function(res) {
								if (res.statusCode == 0) {
									res.data.userName = __this.data.userName,
										res.data.password = __this.data.password,
										__this.data = res.data
									if ($("#login_box").css("display") == "block") {
										__this.display('login_box')
									}
									if ($("#login_success").css("display") == "none") {
										__this.display('login_success')
									}
									$('.user_name').html(__this.data.name),
										$('#user_ban').html(__this.data.ban == 0 ? '正常' : '已封号'),
										__this.loadClass('#user_ban', __this.data.ban == 0 ? 'layui-badge layui-bg-cyan' : 'layui-badge layui-bg-orange'),
										$('#mpoints').html(__this.data.mpoints),
										$('#nxcredit').html(__this.data.nxcredit)
								}
							})
							$.get("/webServer/api/vote", {
								account: __this.data.userName
							}, function(res) {
								__this.data.todayVote = res
								console.log("todayVote=" + __this.data.todayVote)
								$('#todayVote').html(__this.data.todayVote == 0 ? '未投票' : '已投票'),
									__this.loadClass('#todayVote', __this.data.todayVote == 0 ? 'layui-badge layui-bg-orange' : 'layui-badge layui-bg-cyan')
							})
							sessionStorage.setItem("data", JSON.stringify(__this.data))
						}
						setTimeout(function() {
							__this.loadUserInfo()
						}, 60000)
					},
					loadClass: function(name, className) {
						$(`${name}`).removeClass()
						$(`${name}`).addClass(className);
					},
					display: function(name) {
						$(`#${name}`).is(":hidden") ? $(`#${name}`).show() : $(`#${name}`).hide()
					}
				}
				App.init()
			})
			$(document).ready(function() {
				//初始化获取数据
				$.ajax({
					contentType: 'application/json',
					type: 'GET',
					url: "/loginServer/invitation",
					dataType: "json",
					headers: {
						auth: $.cookie('token')
					},
					crossDomain: true,
					success: function(message) {
						if (message.statusCode == 0) {
							var data = message.data;
							$("#parentEmail").val(data.parentEmail);
							$("#parentCode").val(data.parentCode);
							$("#code").val(data.code);
							$("#invitationNumber").val(data.invitationNumber);
						} else {
							layer.alert(message.message);
						}
					}
				});

			});
			$(function() {
				getServers();
				const url = "/loginServer/invitation/findLowLevels";
				layui.use(['table'], function() {
					var table = layui.table
					table.render({
						elem: '#low_levels',
						url: url,
						headers: {
							auth: $.cookie('token')
						},
						id: 'low_levels',
						cols: [
							[{
									field: 'id',
									title: 'ID'
								},
								{
									field: 'name',
									title: '账号'
								},
								{
									field: 'email',
									title: '邮箱'
								},
								{
									field: 'timestamp',
									title: '邀请时间',
									templet: function(res) {
										const timeStamp = res.timestamp;
										if (timeStamp != null && timeStamp > 0) {
											let date = new Date(timeStamp);
											let Y = date.getFullYear() + '-';
											let month = date.getMonth() + 1;
											let M = (month < 10 ? '0' + (month) : month) + '-';
											let day = date.getDate();
											let D = (day < 10 ? '0' + day : day) + ' ';
											let hour = date.getHours();
											let h = (hour < 10 ? '0' + hour : hour) + ':';
											let minute = date.getMinutes();
											let m = (minute < 10 ? '0' + minute : minute) + ':';
											let second = date.getSeconds();
											let s = second < 10 ? '0' + second : second;
											return Y + M + D + h + m + s;
										} else {
											return "";
										}
									}
								},
								{
									fixed: 'right',
									align: 'center',
									toolbar: '#operations'
								}
							]
						],
						page: true,
						parseData: function(res) {
							if (res.statusCode == 0) {
								return {
									"code": res.statusCode,
									"data": res.data.content,
									"count": res.data.totalElements
								};
							}
							return {
								"msg": res.message
							};
						}
					});
					table.on('tool(low_levels)', function(obj) {
						const lineData = obj.data;
						const event = obj.event;
						if (event == 'detail') {
							const id = lineData.id;
							layer.open({
								title: "请选择大区",
								type: 1,
								area: ['600px', '200px'],
								content: $("#servers_div"),
								btn: ['取消', '确定'],
								shade: 0,
								btn1: function(index) {
									layer.close(index);
								},
								btn2: function(index) {
									const choose = $(':radio[name="server"]:checked').val();
									if (undefined == choose) {
										layer.close(index);
									} else {
										layer.open({
											title: "邀请玩家角色信息",
											type: 1,
											area: ['1000px', '600px'],
											content: $("#characters_div"),
											btn: ['取消'],
											shade: 0,
											btn1: function(index) {
												layer.close(index);
											},
											success: function(index) {
												const url = "/loginServer/invitation/findLowLevelCharacters?serverID=" + choose + "&accountID=" + id;
												table.render({
													elem: "#characters",
													url: url,
													limit: 10,
													id: 'characters',
													headers: {
														auth: $.cookie(
															'token')
													},
													cols: [
														[{
																field: 'name',
																title: '角色昵称'
															},
															{
																field: 'level',
																title: '等级'
															},
															{
																field: 'map',
																title: '所在地图'
															},
															{
																field: 'job',
																title: '职业'
															}
														]
													],
													page: true,
													parseData: function(
														res) {
														if (res
															.statusCode ==
															0) {
															return {
																"code": res
																	.statusCode,
																"data": res
																	.data
																	.content,
																"count": res
																	.data
																	.totalElements
															};
														}
														return {
															"msg": res
																.message
														};
													}
												})
											}
										});
									}
								},
								success: function(layero, index) {
									form.render('radio');

								}
							});
						}
					});

				})
			});

			getServers = function() {
				$.ajax({
					url: "/loginServer/getServers",
					headers: {
						auth: $.cookie('token')
					},
					type: "get",
					dataType: "json",
					async: false,
					success: function(result) {
						if (result.statusCode == 0) {
							const data = result.data;
							if (data.length == 0) {
								layer.alert("未找到大区相关信息");
							} else {
								for (var i = 0; i < data.length; i++) {
									$("#choose_server").append("<input type = 'radio' name='server' value='" + data[i].serverId + "' title='" + data[i].name + "'/>");
								}
								$("#server_form")[0].reset();
							}
						}
					}
				})
			}
		</script>
	</body>
</html>
