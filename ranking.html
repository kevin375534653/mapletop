<html lang="en">
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<head>
		<BASE HREF="" />
		<link rel="stylesheet" type="text/css" href="css/banner-styles2d4a.css?v=omkqRugM" />
		<link rel="stylesheet" type="text/css" href="css/iconochive8307.css?v=qtvMKcIJ" />
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="{WebDescripcion}">
		<meta name="keywords" content="{keywords}">
		<meta name="robots" content="index,follow,noodp,noydir">
		<title>Maple社区 | Kaotic version</title>
		<meta property="og:title" content="Kaotic">
		<meta property="og:type" content="article">
		<meta property="og:url" content="https://mastermaple.com/">
		<meta property="og:image" content="https://mastermaple.com/img/slider2.png">
		<meta property="og:site_name" content="Kaotic">
		<meta property="og:description" content="Enjoy the old maplestory with several custom functions that changes the way you play kaotically">

		<link rel="icon" href="img/favicon.ico">
		<link href="css/gnb_cdn_http_white.css" rel="stylesheet" type="text/css">
		<link href="./css/common.css" rel="stylesheet" />
		<link href="./css/Notice.css" rel="stylesheet" />
		<link href="./layui/css/layui.css" rel="stylesheet" />
		<script src="./layui/layui.js"></script>
		<script src="./js/jquery-2.1.4.min.js"></script>
		<script src="./js/jquery.easing.1.3.js"></script>
		<script src="./js/jquery.colorbox-1.4.27.min.js"></script>
		<script src="./js/swiper.min.js"></script>
		<script src="./js/jquery.placeholder.min.js"></script>
		<script src="./js/jquery.cookie.js"></script>
		<script src="./js/Common.js"></script>
		<script src="./js/npf_auth_c.js" type="text/javascript"></script>
		<script src="./js/NGMModuleInfo.js" type="text/javascript"></script>
		<script src="./js/npf_ngm.js" type="text/javascript"></script>
	</head>
	<body class="night">
		<style type="text/css">
			body {
				margin-top: 0 !important;
				padding-top: 0 !important;
				/*min-width:800px !important;*/
			}

			.sub .side-menu {
				top: 110px;
			}

			.zoom {
				transition: transform .2s;
				margin: 0 auto;
			}

			.zoom:hover {
				transform: scale(1.1);
			}

			.list .entry01 h3 {
				background: url(img/sttl_03.png) no-repeat 0 0;
				height: 50px;
				margin: 10px auto 30px;
			}

			.half {
				width: 50%;
				text-align: initial;
				float: left;
			}

			form input,
			form select {
				height: 30px !important;
				font-size: 12px !important;
				margin-top: 2px !important;
			}

			span {
				font-size: 12px;
			}

			.sub aside .btn-login {
				left: 35px !important;
			}

			.sub aside .btn-regist {
				left: 35px !important;
			}

			input[type=text],
			input[type=password] {
				border: solid 1px #eee;
			}

			.layui-form-select .layui-edge {
				right: 23px;
			}

			.layui-icon.layui-icon-search {
				position: absolute;
				right: 23px;
				top: 50%;
				margin-top: -12px;
			}

			.layui-table-cell {
				height: auto;
				line-height: 28px;
			}
		</style>
		<div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;">
			<div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
			</div>
		</div>
		<div class="wrapper">

			<header>
				<h1><a href="../">Maple社区</a></h1>
				<nav>
					<ul>
						<li class="menu01">
							<a href="./index.html">Inicio</a>

						</li>
						<li class="menu02">
							<a href="./download.html">Downloads</a>

						</li>
						<li class="menu03">
							<a href="./ranking.html">Ranking</a>

						</li>
						<li class="menu04">
							<a href="./web/topsites.html"></a>

						</li>
						<li class="menu05">
							<a href="javascript:;" onclick="layui.layer.msg('功能正在开发')">More</a>

						</li>
					</ul>
				</nav>
			</header>

			<div class="container">
				<article class="list">
					<div class="section entry01" id="anc01">
						<div class="inner" id="noticeList">
							<div class="search-box">
								<p class="btn-search"><a href="javascript:void(0);" onclick="history.back()">return</a>
								</p>
								<input type="text" style="display:none;" value="1" name="setpage" id="setpage">
							</div>
							<h3>Noticia</h3>
							<div class="notice-area" id="notice-area">
								<div style="height:auto;">
									<ul class="latest">
										<li>
											<div class="layui-card">
												<form class="layui-form" action="">
													<div class="layui-row">
														<div class="layui-form-item">
															<label class="layui-form-label">查询类型</label>
															<div class="layui-input-inline">
																<select class="layui-input" id="type" name="type" lay-filter="type">
																	<option value="1">等级排行榜</option>
																	<option value="2">人气排行榜</option>
																</select>
															</div>
														</div>
													</div>
												</form>
												<div class="layui-table" id="search_table" lay-filter="search_table">
												</div>
											</div>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</article>

				<!-- 登陆 -->
				<div class="sub">
					<!-- 登陆注册 -->
					<aside id="login_box">
						<form id="FormRegistro">
							<p class="btn-login" style="margin-top: 86px;">
								<input type="text" name="login_username" id="login_username" placeholder="用户名"><br>
								<input type="password" name="login_password" id="login_password" placeholder="密码">
							</p>
						</form>
						<p class="btn-regist" style="bottom: 43px !important;display: block;">
							<a href="javascript:void(0)" class="btnlogin"></a>
						</p>
					</aside>
					<!-- 用户功能 -->
					<aside id="login_success">
						<p class="btn-login">
							<span>用户名：<label class="user_name"></label></span><br />
							<span>账号状态：
								<span id="user_ban"></span>
								<span id="todayVote"></span>
							</span><br>
							抵用券：<span id="mpoints" class="layui-badge layui-bg-green"></span>
							点券：<span id="nxcredit" class="layui-badge layui-bg-green"></span>
						</p>
						<p class="btn-ability">
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./web/reset_status.html">卡号自救</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./web/invitation.html">邀请系统</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./web/reset_password.html">修改密码</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./web/exchange_use.html">充值卡密</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./web/bindMac.html">绑机器码</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./web/bindMobile.html">绑定手机</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./web/resetMobile.html">更换手机</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./web/invitation_code_add.html">邀请码</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal" href="./web/bindSecondPass.html">二次密保</a>
							<a class="layui-btn layui-btn-xs layui-btn-normal logout" href="javascript:;">退出登陆</a>
						</p>
					</aside>
				</div>
			</div>

		</div>
		<script type="text/javascript">
			layui.use(['table', 'form'], function() {
				var form = layui.form,
					table = layui.table
				App = {
					init() {
						var __this = this,
							type = __this.getUrlParam("type") == null ? 1 : __this.getUrlParam("type")
						load = sessionStorage.getItem("data")
						$("#type").find(`option[value=${type}]`).attr("selected", true),
							__this.loadTable(type)
						form.render("select")
						if (load != null) {
							__this.data = JSON.parse(load),
								__this.loadUserInfo()
						}

						form.on('select(type)', function(res) {
							__this.loadTable(res.value)
						})
						$('.btnlogin').click(function() {
							__this.data.userName = $('#login_username').val(),
								__this.data.password = $('#login_password').val()
							$.ajax({
								contentType: 'application/json',
								type: 'POST',
								url: "/loginServer/auth/login",
								dataType: "json",
								data: JSON.stringify({
									name: __this.data.userName,
									password: __this.data.password
								}),
								success: function(message) {
									if (message.statusCode == 0) {
										$.cookie('token', message.data);
										__this.loadUserInfo()
									} else {
										layer.alert(message.message);
									}
								},
								error: function(res) {
									layer.msg(res.message)
								}
							})
						});

						$('.logout').click(function() {
							sessionStorage.removeItem("data"),
								$.cookie('token', null),
								__this.display('login_box'),
								__this.display('login_success')
						})
					},
					loadTable(type) {
						var __this = this,
							colsData = [{
									type: "numbers",
									title: "排名"
								},
								(type == 1 ? {
									field: "level",
									title: "等级"
								} : {
									field: "fame",
									title: "人气"
								}),
								{
									field: "name",
									title: "玩家昵称"
								},
								{
									field: "image",
									title: "玩家形象",
									templet: function(res) {
										return `<img src="${res.icon}" />`
									}
								}
							]
						table.render({
							elem: "#search_table",
							url: `/webServer/characters/getRanking?type=${type}&top=20`,
							method: 'GET',
							request: {
								pageName: "pageNo",
								limitName: "pageSize"
							},
							cols: [
								colsData
							],
							parseData: function(res) {
								return {
									"code": 0,
									"data": res,
									"count": res.length
								};
							}
						})
					},
					loadUserInfo: function() {
						var __this = this
						if (__this.data.userName != null && __this.data.password != null) {
							$.get(`/loginServer/api/webLogin`, {
								userName: __this.data.userName,
								password: __this.data.password
							}, function(res) {
								if (res.statusCode == 0) {
									res.data.userName = __this.data.userName,
										res.data.password = __this.data.password,
										__this.data = res.data
									if ($("#login_box").css("display") == "block") {
										__this.display('login_box')
									}
									if ($("#login_success").css("display") == "none") {
										__this.display('login_success')
									}
									$('.user_name').html(__this.data.name),
										$('#user_ban').html(__this.data.ban == 0 ? '正常' : '已封号'),
										__this.loadClass('#user_ban', __this.data.ban == 0 ? 'layui-badge layui-bg-cyan' : 'layui-badge layui-bg-orange'),
										$('#mpoints').html(__this.data.mpoints),
										$('#nxcredit').html(__this.data.nxcredit)
								}
							})
							$.get("/webServer/api/vote", {
								account: __this.data.userName
							}, function(res) {
								__this.data.todayVote = res
								console.log("todayVote=" + __this.data.todayVote)
								$('#todayVote').html(__this.data.todayVote == 0 ? '未投票' : '已投票'),
									__this.loadClass('#todayVote', __this.data.todayVote == 0 ? 'layui-badge layui-bg-orange' : 'layui-badge layui-bg-cyan')
							})
							sessionStorage.setItem("data", JSON.stringify(__this.data))
						}
						setTimeout(function() {
							__this.loadUserInfo()
						}, 60000)
					},
					loadClass: function(name, className) {
						$(`${name}`).removeClass()
						$(`${name}`).addClass(className);
					},
					display: function(name) {
						$(`#${name}`).is(":hidden") ? $(`#${name}`).show() : $(`#${name}`).hide()
					},
					getUrlParam(name) {
						var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
						var r = window.location.search.substr(1).match(reg); //匹配目标参数
						if (r != null) return unescape(r[2]);
						return null; //返回参数值
					},
				};
				App.init()
			})
		</script>
	</body>
</html>
